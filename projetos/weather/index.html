<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Clima São Paulo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="/lib/jquery-3.2.1.min.js"></script>
</head>
<body>
    <form id="date-form" onsubmit="return false;">
        <input type="date" id="date-selector" min="1996-30-06" required>
        <input type="submit" value="submit">
    </form>

    <table id="results-table">
        <tr>
            <th>Hora</th>
            <th>Condição</th>
            <th>Temperatura</th>
            <th>Humidade</th>
            <th>Pressão</th>
            <th>Visibilidade</th>
            <th>Direção do Vento A</th>
            <th>Direção do Vento B</th>
            <th>Velocidade do Vento</th>
        </tr>
    </table>

    <script>
        $(function() {
            $.ajax({
                url: "get-last.php",
                success: function (data) {
                    $("#date-selector").attr("max", data)
                }
            });

            $("#date-form").on("submit", function() {
                $.ajax({
                    url: "query.php?date=" + $("#date-selector").val(),
                    success: function(json) {
                        var data = JSON.parse(json),
                            hoursHTML = "";

                        $("#results-table tr:not(:first-child)").remove();

                        for (var i in data.hourly) {
                            var hour = data.hourly[i],
                                date = new Date(hour.datetime);

                            hoursHTML += `                                
                                <tr>                                
                                    <td>` + date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds() + `</td>
                                    <td>` + hour.conds + `</td>
                                    <td>` + hour.tempm + `</td>
                                    <td>` + hour.hum + `</td>
                                    <td>` + hour.pressurem + `</td>
                                    <td>` + hour.vism + `</td>
                                    <td>` + hour.wdire + `</td>
                                    <td>` + hour.wdird + `</td>
                                    <td>` + hour.wspdm + `</td>                                
                                </tr>                                
                            `;
                        }

                        $("#results-table").append(hoursHTML);                        
                    }
                });
            });
        });
    </script>
</body>
</html>