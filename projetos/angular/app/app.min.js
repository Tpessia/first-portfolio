var app=angular.module("noisePolution",["ngRoute"]);app.config(function($routeProvider,$locationProvider){$routeProvider.when("/",{controller:"HomeController",templateUrl:"app/home/home.partial.html"}).when("/tracks",{title:"Tracks",controller:"TracksController",templateUrl:"app/tracks/tracks.partial.html"}).when("/artists",{title:"Artists",controller:"ArtistsController",templateUrl:"app/artists/artists.partial.html"}).when("/albuns",{title:"Albuns",controller:"AlbunsController",templateUrl:"app/albuns/albuns.partial.html"}).otherwise({redirectTo:"/"})}),app.run(function($rootScope){$rootScope.$on("$routeChangeSuccess",function(event,current,previous){$rootScope.title=current.$$route.title})}),app.controller("PaginationController",function($scope){$scope.currentPage=1,$scope.lastPage=1,$scope.offsetPage=0,$scope.nextPage=function(){$scope.lastPage=$scope.currentPage,$scope.currentPage+1==$scope.offsetPage+$scope.maxPage&&$scope.offsetPage++,$scope.currentPage+=1},$scope.prevPage=function(){if($scope.lastPage=$scope.currentPage,$scope.currentPage-1<=0)return!1;$scope.currentPage-1==$scope.offsetPage+1&&0<$scope.currentPage-2&&$scope.offsetPage--,$scope.currentPage-=1},$scope.goToPage=function(page){$scope.lastPage=$scope.currentPage,page==$scope.offsetPage+$scope.maxPage?$scope.offsetPage++:page==$scope.offsetPage+1&&page-1!=0&&$scope.offsetPage--,$scope.currentPage=page},$scope.getNumber=function(num){return new Array(num)},$scope.$watch("currentPage",function(newVal,oldVal){$scope.pageChangeFunc({page:newVal})})}),app.directive("materializePag",function(){return{scope:{maxPage:"=maxPage",pageChangeFunc:"&pageChangeFunc"},templateUrl:"app/directives/pagination.partial.html"}}),app.directive("searchWide",function(){return{templateUrl:"app/directives/search.partial.html"}}),app.service("albunsService",function(){}),app.service("apiKeysService",function(){var apiKeys=["a431af7680e5bd6e612b0eefd5448a06","61b502648995e8805c36d0996d41b879","e443ac025fea43b249a36e29b0f12a91"];this.getKey=function(){return apiKeys[Math.floor(Math.random()*apiKeys.length)]}}),app.service("artistsService",function(){}),app.service("topsService",function($http,apiKeysService){this.getTopTracks=function(page,limit){return $http.get("//ws.audioscrobbler.com/2.0/?method=chart.gettoptracks&api_key="+apiKeysService.getKey()+"&format=json&limit="+limit+"&page="+page)},this.getTopArtists=function(page,limit){return $http.get("//ws.audioscrobbler.com/2.0/?method=chart.gettopartists&api_key="+apiKeysService.getKey()+"&format=json&limit="+limit+"&page="+page)},this.getTopTags=function(page,limit){return $http.get("//ws.audioscrobbler.com/2.0/?method=chart.gettoptags&api_key="+apiKeysService.getKey()+"&format=json&limit="+5*page)},this.getTopArtistsByTag=function(tag,page,limit){return $http.get("//ws.audioscrobbler.com/2.0/?method=tag.gettopartists&api_key="+apiKeysService.getKey()+"&format=json&limit="+limit+"&tag="+tag+"&page="+page)},this.getTheTopTrack=function(page){return $http.get("//ws.audioscrobbler.com/2.0/?method=chart.gettoptracks&api_key="+apiKeysService.getKey()+"&format=json&limit=1")},this.getTheTopArtist=function(page){return $http.get("//ws.audioscrobbler.com/2.0/?method=chart.gettopartists&api_key="+apiKeysService.getKey()+"&format=json&limit=1")},this.getTheTopTag=function(page){return $http.get("//ws.audioscrobbler.com/2.0/?method=chart.gettoptags&api_key="+apiKeysService.getKey()+"&format=json&limit=1")}}),app.service("tracksService",function($http){this.getTrackInfo=function(artist,track){return $http.get("//ws.audioscrobbler.com/2.0/?method=track.getInfo&api_key=e443ac025fea43b249a36e29b0f12a91&format=json&artist="+artist+"&track="+track)}}),app.controller("AlbunsController",function($scope,albunsService){}),app.controller("ArtistsController",function($scope,artistsService){}),app.controller("HomeController",function($scope,topsService,tracksService){var dft_page=1,dft_limit=5;$scope.getTopTracks=function(page,limit){if(void 0===page)page=dft_page;void 0===limit&&(limit=dft_limit);var progressBar=$$("#tracks-wrapper .progress");angular.element(progressBar).removeClass("hide"),topsService.getTopTracks(page,limit).then(function(response){for(var i in angular.element(progressBar).addClass("hide"),$scope.tracks=response.data.tracks.track.slice(-5),$scope.tracks)!function(j){tracksService.getTrackInfo($scope.tracks[j].artist.name,$scope.tracks[j].name).then(function(response){void 0!==response.data.track.album&&($scope.tracks[j].image=response.data.track.album.image,$scope.tracks[j].info=response.data.track)},function(errResponse){console.log(errResponse)})}(i);console.log(response.data)},function(errResponse){angular.element(progressBar).addClass("hide"),console.log(errResponse)})},$scope.getTopArtists=function(page,limit){if(void 0===page)page=dft_page;void 0===limit&&(limit=dft_limit);var progressBar=$$("#artists-wrapper .progress");angular.element(progressBar).removeClass("hide"),topsService.getTopArtists(page,limit).then(function(response){angular.element(progressBar).addClass("hide"),$scope.artists=response.data.artists.artist.slice(-5),console.log(response.data)},function(errResponse){angular.element(progressBar).addClass("hide"),console.log(errResponse)})},$scope.getTopTags=function(page,limit){if(void 0===page)page=dft_page;void 0===limit&&(limit=dft_limit);var progressBar=$$("#tags-wrapper .progress");angular.element(progressBar).removeClass("hide"),topsService.getTopTags(page,limit).then(function(response){for(var i in angular.element(progressBar).addClass("hide"),$scope.tags=response.data.tags.tag.slice(-5),$scope.tags)!function(j){topsService.getTopArtistsByTag($scope.tags[j].name,page,limit).then(function(response){$scope.tags[j].image=response.data.topartists.artist[0].image},function(errResponse){$scope.tags.image=[{"#text":"../assets/img/logo-simple-256x256.png"},{"#text":"../assets/img/logo-simple-256x256.png"},{"#text":"../assets/img/logo-simple-256x256.png"},{"#text":"../assets/img/logo-simple-256x256.png"},{"#text":"../assets/img/logo-simple-256x256.png"}],console.log(errResponse)})}(i);console.log(response.data)},function(errResponse){angular.element(progressBar).addClass("hide"),console.log(errResponse)})},function(limit){void 0===limit&&(limit=dft_limit);var page=Math.round(15*Math.random());topsService.getTopTracks(page,limit).then(function(response){for(var i in $scope.rndTracks=response.data.tracks.track.slice(-5),$scope.rndTracks)!function(j){tracksService.getTrackInfo($scope.rndTracks[j].artist.name,$scope.rndTracks[j].name).then(function(response){void 0!==response.data.track.album&&($scope.rndTracks[j].image=response.data.track.album.image,$scope.rndTracks[j].info=response.data.track)},function(errResponse){console.log(errResponse)})}(i);console.log(response.data)},function(errResponse){$scope.rndTracks=$scope.tracks,console.log(errResponse)})}(5),$scope.cutStr=function(text,letters){return text.length>letters?text.substr(0,letters)+"...":text}}),app.controller("HeaderController",function($scope,$location,topsService){var fallbackImg;$scope.navItens=[{text:"Home",url:"/"},{text:"Tracks",url:"/tracks"},{text:"Artists",url:"/artists"},{text:"Albuns",url:"/albuns"}],$scope.isActive=function(url){return url==$location.path()},$scope.topsImg={},fallbackImg="../assets/img/logo-simple-256x256.png",topsService.getTheTopTrack().then(function(response){$scope.topsImg.img1=response.data.tracks.track[0].image.pop()["#text"]},function(errResponse){$scope.topsImg.img1=fallbackImg,console.log("Error while fetching tops (header) images: "+errResponse)}),topsService.getTheTopArtist().then(function(response){$scope.topsImg.img2=response.data.artists.artist[0].image.pop()["#text"]},function(errResponse){$scope.topsImg.img2=fallbackImg,console.log("Error while fetching tops (header) images: "+errResponse)}),topsService.getTheTopTag().then(function(response){var tag=response.data.tags.tag[0].name;topsService.getTopArtistsByTag(tag).then(function(response){$scope.topsImg.img3=response.data.topartists.artist[0].image.pop()["#text"]},function(errResponse){$scope.topsImg.img3=fallbackImg,console.log("Error while fetching tops (header) images: "+errResponse)})})}),app.controller("TracksController",function($scope,tracksService){});
//# sourceMappingURL=app.min.js.map