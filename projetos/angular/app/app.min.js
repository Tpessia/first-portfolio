var app=angular.module("noisePolution",["ngRoute","youtube-embed","angularFileUpload"]);app.config(function($routeProvider,$locationProvider){$routeProvider.when("/",{title:"",controller:"HomeController",templateUrl:"app/home/home.partial.html"}).when("/tracks",{title:"Tracks",controller:"TracksController",templateUrl:"app/tracks/tracks.partial.html",reloadOnSearch:!1}).when("/artists",{title:"Artists",controller:"ArtistsController",templateUrl:"app/artists/artists.partial.html",reloadOnSearch:!1}).when("/albums",{title:"Albums",controller:"AlbumsController",templateUrl:"app/albums/albums.partial.html",reloadOnSearch:!1}).when("/user/playlists",{title:"User Playlists",controller:"UserPlaylistsController",templateUrl:"app/userplaylists/userplaylists.partial.html",reloadOnSearch:!1}).when("/user",{title:"User Settings",controller:"UserSettingsController",templateUrl:"app/usersettings/usersettings.partial.html"}).otherwise({redirectTo:"/"})}),app.run(function($rootScope,$window,$timeout){$rootScope.$on("$routeChangeSuccess",function(event,current,previous){$rootScope.title=current.$$route.title,$rootScope.titleClass=""==current.$$route.title?"home":current.$$route.title.toLowerCase().replace(/ /g,"");var breadcrumbItems=current.$$route.originalPath.split(/\//g).filter(function(e){return""!=e});0==breadcrumbItems.length?breadcrumbItems[0]="home":breadcrumbItems.unshift("home"),$rootScope.breadcrumb={items:breadcrumbItems,urls:function(index){return"#!/"+$rootScope.breadcrumb.items.filter(function(e,i){return i<index+1}).filter(function(e){return"home"!=e}).join("/")}},void 0!==previous&&current.$$route.originalPath!=previous.$$route.originalPath&&$window.scrollTo(0,0)}),$rootScope.baseUrl=$window.location.pathname.substring(0,$window.location.pathname.lastIndexOf("/"))+"/",$rootScope.fallbackImg=$rootScope.baseUrl+"assets/img/logo-simple-512x512.png",$rootScope.materialize={headerDropdown:function(){return M.Dropdown.init($$("#user-dropdown")[0],{alignment:"right"})},sidenav:function(){var sidenav=M.Sidenav.init($$(".sidenav")[0],{});return angular.element($$(".sidenav li")).on("click",function(){sidenav.close()}),sidenav},all:function(){return{headerDropdown:this.headerDropdown(),sidenav:this.sidenav()}}},$timeout(function(){$rootScope.materialize.all()},10)}),app.controller("CarouselPlaylistsController",function($rootScope,$scope){$scope.fallbackImg=$rootScope.fallbackImg,$scope.$watch("focusedElem",function(newElem,oldElem){if(newElem!==oldElem&&void 0!==oldElem){var playlistId=newElem.getAttribute("data-playlist-id");$scope.onSlide({playlistId:playlistId})}})}),app.directive("carouselPlaylists",function(){return{scope:{playlists:"=",initialSlide:"=?",onSlide:"&"},controller:"CarouselPlaylistsController",templateUrl:"app/_directives/carousel-playlists/carousel-playlists.partial.html",link:function(scope,element,attrs){setTimeout(function(){M.Carousel.init($$(".carousel"),{dist:-10,shift:10,padding:5,indicators:!0,onCycleTo:function(elem){scope.$apply(function(){scope.focusedElem=elem})}})[0].set(scope.initialSlide)},100)}}}),app.controller("MaterializeFabController",function($scope,userService){$scope.user=userService.user,$scope.onPlaylistSelect=function(playlistId){$scope.add({playlistId:playlistId})}}),app.directive("materializeVideoFab",function(){return{scope:{index:"=",play:"&",add:"&"},controller:"MaterializeFabController",templateUrl:"app/_directives/fab/fab.partial.html",link:function(scope,element,attrs){setTimeout(function(){M.FloatingActionButton.init($$(".video-fab"),{direction:"bottom",hoverEnabled:!1})},100)}}}),app.controller("GridAlbumsController",function($rootScope,$scope){$scope.cutStr=function(text,letters){return text.length>letters?text.substr(0,letters)+"...":text},$scope.saveOnPlaylist=function(playlistId,videoData){$rootScope.$broadcast("userSaveTrack",{playlistId:playlistId,videoData:videoData})},$scope.ytVideo={open:function(videoData){$rootScope.$broadcast("ytPlayVideo",videoData)}},$scope.searchFor=function(type,value){switch(type){case"track":return $rootScope.baseUrl+"#!/tracks?search="+value;case"artist":return $rootScope.baseUrl+"#!/artists?search="+value;case"album":return $rootScope.baseUrl+"#!/albums?search="+value;default:throw'Invalid video type "'+type+'"'}}}),app.directive("gridAlbums",function(){return{scope:{series:"="},controller:"GridAlbumsController",templateUrl:"app/_directives/gridalbums/gridalbums.partial.html"}}),app.controller("GridArtistsController",function($rootScope,$scope){$scope.cutStr=function(text,letters){return text.length>letters?text.substr(0,letters)+"...":text},$scope.saveOnPlaylist=function(playlistId,videoData){$rootScope.$broadcast("userSaveTrack",{playlistId:playlistId,videoData:videoData})},$scope.ytVideo={open:function(videoData){$rootScope.$broadcast("ytPlayVideo",videoData)}},$scope.searchFor=function(type,value){switch(type){case"track":return $rootScope.baseUrl+"#!/tracks?search="+value;case"artist":return $rootScope.baseUrl+"#!/artists?search="+value;case"album":return $rootScope.baseUrl+"#!/albums?search="+value;default:throw'Invalid video type "'+type+'"'}}}),app.directive("gridArtists",function(){return{scope:{series:"="},controller:"GridArtistsController",templateUrl:"app/_directives/gridartists/gridartists.partial.html"}}),app.controller("GridTracksController",function($rootScope,$scope){$scope.cutStr=function(text,letters){return text.length>letters?text.substr(0,letters)+"...":text},$scope.saveOnPlaylist=function(playlistId,videoData){$rootScope.$broadcast("userSaveTrack",{playlistId:playlistId,videoData:videoData})},$scope.ytVideo={open:function(videoData){$rootScope.$broadcast("ytPlayVideo",videoData)}},$scope.searchFor=function(type,value){switch(type){case"track":return $rootScope.baseUrl+"#!/tracks?search="+value;case"artist":return $rootScope.baseUrl+"#!/artists?search="+value;case"album":return $rootScope.baseUrl+"#!/albums?search="+value;default:throw'Invalid video type "'+type+'"'}}}),app.directive("gridTracks",function(){return{scope:{series:"="},controller:"GridTracksController",templateUrl:"app/_directives/gridtracks/gridtracks.partial.html"}}),app.controller("LoginModalController",function($scope,$route){$scope.actions={},$scope.formData={signIn:{},signUp:{}},$scope.actions.signIn=function(){var data=$scope.formData.signIn;$scope.signIn({data:{username:data.username,password:data.password}}).then(function(response){void 0!==response.data.UserID?(M.toast({html:"Logged in",displayLength:"3000"}),$scope.instances[0].close()):(M.toast({html:"Error on login",classes:"red darken-4",displayLength:"3000"}),console.log(response))},function(errResponse){M.toast({html:"Error on login",classes:"red darken-4",displayLength:"3000"}),console.log(errResponse)})},$scope.actions.signUp=function(){var data=$scope.formData.signUp;$scope.signUp({data:{username:data.username,password:data.password,email:data.email}}).then(function(response){void 0!==response.data.UserID?(M.toast({html:"User created",displayLength:"3000"}),$scope.instances[0].close()):(M.toast({html:"Error on user creation",classes:"red darken-4",displayLength:"3000"}),console.log(response))},function(errResponse){M.toast({html:"Error on user creation",classes:"red darken-4",displayLength:"3000"}),console.log(errResponse)})}}),app.directive("loginModal",function(){return{scope:{signIn:"&",signUp:"&"},controller:"LoginModalController",templateUrl:"app/_directives/login/login.partial.html",link:function(scope,element,attr){scope.instances=M.Modal.init($$("#login-modal"),{})}}}),app.controller("PaginationController",function($scope){$scope.currentPage=1,$scope.lastPage=1,$scope.offsetPage=0,$scope.nextPage=function(){$scope.lastPage=$scope.currentPage,$scope.currentPage+1==$scope.offsetPage+$scope.maxPage&&$scope.offsetPage++,$scope.currentPage+=1},$scope.prevPage=function(){if($scope.lastPage=$scope.currentPage,$scope.currentPage-1<=0)return!1;$scope.currentPage-1==$scope.offsetPage+1&&0<$scope.currentPage-2&&$scope.offsetPage--,$scope.currentPage-=1},$scope.goToPage=function(page){$scope.lastPage=$scope.currentPage,page==$scope.offsetPage+$scope.maxPage?$scope.offsetPage++:page==$scope.offsetPage+1&&page-1!=0&&$scope.offsetPage--,$scope.currentPage=page},$scope.getNumber=function(num){return new Array(num)},$scope.$watch("currentPage",function(newVal,oldVal){$scope.runOnInit?$scope.pageChangeFunc({page:newVal}):newVal!==oldVal&&$scope.pageChangeFunc({page:newVal})})}),app.directive("materializePag",function(){return{scope:{runOnInit:"=runOnInit",maxPage:"=maxPage",pageChangeFunc:"&pageChangeFunc"},controller:"PaginationController",templateUrl:"app/_directives/pagination/pagination.partial.html"}}),app.controller("PlaylistSelectionController",function($scope,userService){function addPlaylist(playlistId){$scope.onSelect({playlistId:playlistId}),$scope.instances[0].close(),$scope.newPlaylist=""}$scope.onModalOpen=function(){$scope.$apply(function(){$scope.playlists=userService.savedPlaylists.getAllPlaylists()})},$scope.selectPlaylist=function(playlistId){addPlaylist(playlistId)},$scope.createPlaylist=function(playlistName){userService.savedPlaylists.newPlaylist(playlistName).then(function(response){void 0!==response.data.PlaylistID?(addPlaylist(response.data.PlaylistID),M.toast({html:"Playlist created",displayLength:"3000"})):(M.toast({html:"Error on playlist creation",classes:"red darken-4",displayLength:"3000"}),console.log(response))},function(errResponse){console.log(errResponse)})}}),app.directive("playlistSelection",function(){return{scope:{index:"=",onSelect:"&"},controller:"PlaylistSelectionController",templateUrl:"app/_directives/playlist-selection/playlist-selection.partial.html",link:function(scope,element,attr){setTimeout(function(){scope.instances=M.Modal.init($$("#playlist-selection-"+scope.index),{onOpenStart:scope.onModalOpen})},100)}}}),app.controller("SearchController",function($scope,$location){$scope.searchAvailable=!0,$scope.onSubmit=function(key){$scope.onSearch({searchKey:key})?($scope.searchAvailable=!1,$$(".search-wide input")[0].blur()):M.toast({html:"Invalid search",classes:"red darken-4",displayLength:"3000"})},$scope.close=function(){$location.search("search",null),$scope.searchAvailable=!0,angular.element($$(".search-wide input")).val(""),$scope.onClose()},$scope.$watch("key",function(newVal,oldVal){newVal!==oldVal&&($scope.searchAvailable=!0)}),function(){if(void 0!==$location.search().search){var searchParam=$location.search().search;$scope.key=searchParam,$scope.onSubmit(searchParam)}}()}),app.directive("searchWide",function(){return{scope:{searchFor:"=",key:"=",onSearch:"&",onClose:"&"},controller:"SearchController",templateUrl:"app/_directives/search/search.partial.html"}}),app.controller("YTPlayerController",function($rootScope,$scope,$sce,youTubeService){function cleanPlayer(){$scope.isVisible=!0,delete $scope.YTplayer,delete $scope.videoUrl,$scope.playerVars={autoplay:1,playsinline:1,rel:0}}$scope.isOpen=!1,$scope.isExpanded=!1,$scope.isVisible=!0,$scope.close=function(){$scope.isOpen=!1,cleanPlayer()},$scope.expand=function(){$scope.isExpanded=!$scope.isExpanded},$scope.visibility=function(){$scope.isVisible=!$scope.isVisible},cleanPlayer(),$scope.$on("youtube.player.ready",function($event,player){$scope.YTplayer=player}),$scope.$on("ytPlayVideo",function(event,videoData){switch(videoData.type){case"id":$scope.isOpen=!0,id=videoData.id,cleanPlayer(),$scope.videoUrl=id;break;case"track":$scope.isOpen=!0,artist=videoData.artist,track=videoData.track,youTubeService.getMusicVideo(artist,track).then(function(response){var video=response.data.items[0],id=video.id.videoId;cleanPlayer(),$scope.videoUrl=id},function(errResponse){console.log(errResponse)});break;case"album":$scope.isOpen=!0,function(artist,album){youTubeService.getAlbumPlaylist(artist,album).then(function(response){var playlist=response.data.items[0],id=playlist.id.playlistId;cleanPlayer(),$scope.playerVars.list=id},function(errResponse){console.log(errResponse)})}(videoData.artist,videoData.album);break;case"artist":$scope.isOpen=!0,function(artist){youTubeService.getArtistPlaylist(artist).then(function(response){var playlist=response.data.items[0],id=playlist.id.playlistId;cleanPlayer(),$scope.playerVars.list=id},function(errResponse){console.log(errResponse)})}(videoData.artist);break;default:throw'Invalid video type "'+videoData.type+'"'}var artist,track,id}),$scope.$on("ytPlayCustomPlaylist",function(event,playlist){$scope.isOpen=!0,cleanPlayer(),$scope.playerVars.playlist=playlist.map(function(elem){return elem.videoId}).join(",")})}),app.directive("ytPlayer",function(){return{controller:"YTPlayerController",templateUrl:"app/_directives/ytplayer/ytplayer.partial.html"}}),app.service("albumsService",function($http,apiKeysService){this.getAlbumInfo=function(artist,album){return $http.get("//ws.audioscrobbler.com/2.0/?method=album.getinfo&api_key="+apiKeysService.getLastFmKey()+"&format=json&album="+encodeURIComponent(album)+"&artist="+encodeURIComponent(artist),{cache:!0})},this.getAlbumSearch=function(album,page,limit){return $http.get("//ws.audioscrobbler.com/2.0/?method=album.search&api_key="+apiKeysService.getLastFmKey()+"&format=json&album="+encodeURIComponent(album)+"&limit="+encodeURIComponent(limit)+"&page="+encodeURIComponent(page),{cache:!0})}}),app.service("apiKeysService",function(){var lastFmApiKeys=["a431af7680e5bd6e612b0eefd5448a06","61b502648995e8805c36d0996d41b879","e443ac025fea43b249a36e29b0f12a91","dbe84a52343b027da04e9fadde99a0e8","5bca7eafa851448173501cf75ab15232"],youTubeApiKeys=["AIzaSyA2-xI7nmoHKJKw1tFIWfONlGwqPx2B0MQ"];this.getLastFmKey=function(){return lastFmApiKeys[Math.floor(Math.random()*lastFmApiKeys.length)]},this.getYouTubeKey=function(){return youTubeApiKeys[0]}}),app.service("artistsService",function($http,apiKeysService){this.getArtistInfo=function(artist){return $http.get("//ws.audioscrobbler.com/2.0/?method=artist.getinfo&api_key="+apiKeysService.getLastFmKey()+"&format=json&artist="+encodeURIComponent(artist),{cache:!0})},this.getArtistSearch=function(artist,page,limit){return $http.get("//ws.audioscrobbler.com/2.0/?method=artist.search&api_key="+apiKeysService.getLastFmKey()+"&format=json&artist="+encodeURIComponent(artist)+"&limit="+encodeURIComponent(limit)+"&page="+encodeURIComponent(page),{cache:!0})},this.getTopAlbums=function(artist,page,limit){return $http.get("//ws.audioscrobbler.com/2.0/?method=artist.gettopalbums&api_key="+apiKeysService.getLastFmKey()+"&format=json&artist="+encodeURIComponent(artist)+"&limit="+encodeURIComponent(limit)+"&page="+encodeURIComponent(page),{cache:!0})}}),app.service("topsService",function($http,apiKeysService){this.getTopTracks=function(page,limit){return $http.get("//ws.audioscrobbler.com/2.0/?method=chart.gettoptracks&api_key="+apiKeysService.getLastFmKey()+"&format=json&limit="+encodeURIComponent(limit)+"&page="+encodeURIComponent(page))},this.getTopArtists=function(page,limit){return $http.get("//ws.audioscrobbler.com/2.0/?method=chart.gettopartists&api_key="+apiKeysService.getLastFmKey()+"&format=json&limit="+encodeURIComponent(limit)+"&page="+encodeURIComponent(page),{cache:!0})},this.getTopTags=function(page,limit){return $http.get("//ws.audioscrobbler.com/2.0/?method=chart.gettoptags&api_key="+apiKeysService.getLastFmKey()+"&format=json&limit="+5*encodeURIComponent(page),{cache:!0})},this.getTopArtistsByTag=function(tag,page,limit){return $http.get("//ws.audioscrobbler.com/2.0/?method=tag.gettopartists&api_key="+apiKeysService.getLastFmKey()+"&format=json&limit="+encodeURIComponent(limit)+"&tag="+encodeURIComponent(tag)+"&page="+encodeURIComponent(page),{cache:!0})}}),app.service("tracksService",function($http,apiKeysService){this.getTrackInfo=function(artist,track){return $http.get("//ws.audioscrobbler.com/2.0/?method=track.getInfo&api_key="+apiKeysService.getLastFmKey()+"&format=json&artist="+encodeURIComponent(artist)+"&track="+encodeURIComponent(track),{cache:!0})},this.getTrackSearch=function(track,page,limit){return $http.get("//ws.audioscrobbler.com/2.0/?method=track.search&api_key="+apiKeysService.getLastFmKey()+"&format=json&track="+encodeURIComponent(track)+"&limit="+encodeURIComponent(limit)+"&page="+encodeURIComponent(page),{cache:!0})}}),app.service("userService",function($rootScope,$http){var self=this;this.user={isLogged:!1,avatar:null,name:null,email:null},this.userSecure={username:null,userId:null},this.signUp=function(data){return void 0!==data?$http.post($rootScope.baseUrl+"src/php/user.signup.php",data).then(function(response){return void 0!==response.data.UserID&&$http.post($rootScope.baseUrl+"src/php/session.create.php",data),response},function(errResponse){return console.log(errResponse),errResponse}):new Promise(function(resolve,reject){resolve({data:"0"})})},this.signIn=function(data){return void 0!==data?$http.post($rootScope.baseUrl+"src/php/user.signin.php",data).then(function(response){return void 0!==response.data.UserID&&$http.post($rootScope.baseUrl+"src/php/session.create.php",{username:response.data.Username,password:response.data.Password}),response},function(errResponse){return console.log(errResponse),errResponse}):new Promise(function(resolve,reject){resolve({data:"0"})})},this.logOut=function(){return $http.get($rootScope.baseUrl+"src/php/session.delete.php").then(function(response){return response},function(errResponse){return errResponse})},this.sessionLogin=function(){return $http.get($rootScope.baseUrl+"src/php/session.login.php")},this.savedPlaylistsArray=[],this.savedPlaylists={loadPlaylists:function(){return self.user.isLogged?$http.post($rootScope.baseUrl+"src/php/track.getall.php",{user:self.userSecure.userId}).then(function(response){if(void 0!==response.data&&"object"==typeof response.data){var rawPlaylists=response.data,playlist=[];for(var i in rawPlaylists)for(var j in playlist[i]={playlistId:rawPlaylists[i].PlaylistID,name:rawPlaylists[i].Name,list:[],date:rawPlaylists[i].CreationDate},rawPlaylists[i].list){var list=rawPlaylists[i].list[j];playlist[i].list.push({trackId:list.TrackID,videoId:list.Video,title:list.Title,img:list.Image,date:list.AdditionDate})}self.savedPlaylistsArray=playlist}else console.log(response);return response},function(errResponse){return console.log(errResponse),response}):new Promise(function(resolve,reject){resolve({data:"0"})})},newPlaylist:function(playlistName){return self.user.isLogged&&!this.playlistExistsName(playlistName)?$http.post($rootScope.baseUrl+"src/php/playlist.create.php",{name:playlistName,user:self.userSecure.userId}).then(function(response){return void 0!==response.data.PlaylistID?self.savedPlaylistsArray.push({playlistId:response.data.PlaylistID,name:response.data.Name,date:new Date(response.data.CreationDate),list:[]}):console.log(response),response},function(errResponse){return console.log(errResponse),response}):new Promise(function(resolve,reject){resolve({data:"0"})})},deletePlaylist:function(playlistId){var $this=this;return self.user.isLogged&&this.playlistExistsId(playlistId)?$http.post($rootScope.baseUrl+"src/php/playlist.delete.php",{playlist:playlistId,user:self.userSecure.userId}).then(function(response){return void 0!==response.data.PlaylistID?self.savedPlaylistsArray.splice($this.getIndexId(playlistId),1):console.log(response),response},function(errResponse){return console.log(errResponse),response}):new Promise(function(resolve,reject){resolve({data:"0"})})},renamePlaylist:function(playlistId,newName){var $this=this;return self.user.isLogged&&this.playlistExistsId(playlistId)&&!this.playlistExistsName(newName)?$http.post($rootScope.baseUrl+"src/php/playlist.rename.php",{playlist:playlistId,newName:newName,user:self.userSecure.userId}).then(function(response){return void 0!==response.data.PlaylistID?self.savedPlaylistsArray[$this.getIndexId(playlistId)].name=newName:console.log(response),response},function(errResponse){return console.log(errResponse),response}):new Promise(function(resolve,reject){resolve({data:"0"})})},getPlaylist:function(playlistId){return!(!self.user.isLogged||!this.playlistExistsId(playlistId))&&self.savedPlaylistsArray[this.getIndexId(playlistId)]},getAllPlaylists:function(){return!!(self.user.isLogged&&0<self.savedPlaylistsArray.length)&&self.savedPlaylistsArray},addTrack:function(playlistId,trackData){var $this=this;return self.user.isLogged&&this.playlistExistsId(playlistId)&&void 0!==trackData?$http.post($rootScope.baseUrl+"src/php/track.add.php",{title:trackData.title,video:trackData.videoId,img:trackData.img,playlist:playlistId,user:self.userSecure.userId}).then(function(response){return void 0!==response.data.PlaylistID?self.savedPlaylistsArray[$this.getIndexId(playlistId)].list.push({trackId:response.data.TrackID,title:response.data.Title,videoId:response.data.Video,img:response.data.Image,date:new Date(response.data.AdditionDate)}):console.log(response),response},function(errResponse){return console.log(errResponse),response}):new Promise(function(resolve,reject){resolve({data:"0"})})},removeTrack:function(playlistId,trackId){var $this=this;return self.user.isLogged&&this.playlistExistsId(playlistId)&&0<trackId?$http.post($rootScope.baseUrl+"src/php/track.remove.php",{track:trackId,playlist:playlistId,user:self.userSecure.userId}).then(function(response){if(void 0!==response.data.PlaylistID){var plIndex=$this.getIndexId(playlistId),tkIndex=self.savedPlaylistsArray[plIndex].list.findIndex(function(e){return e.trackId==trackId});self.savedPlaylistsArray[plIndex].list.splice(tkIndex,1)}else console.log(response);return response},function(errResponse){return console.log(errResponse),response}):new Promise(function(resolve,reject){resolve({data:"0"})})},appendPlaylist:function(playlistId,sourcePlaylist){if(self.user.isLogged&&this.playlistExistsId(playlistId)&&void 0!==sourcePlaylist){var request=new Promise(function(resolve,reject){resolve({data:"0"})});for(var i in sourcePlaylist)request=this.addTrack(playlistId,sourcePlaylist[i]);return request}return new Promise(function(resolve,reject){resolve({data:"0"})})},getIndexName:function(name){var index=self.savedPlaylistsArray.findIndex(function(e){return e.name==name});return 0<=index&&index},getIndexId:function(playlistId){var index=self.savedPlaylistsArray.findIndex(function(e){return e.playlistId==playlistId});return 0<=index&&index},playlistExistsName:function(name){return 0<self.savedPlaylistsArray.filter(function(e){return e.name==name}).length},playlistExistsId:function(playlistId){return 0<self.savedPlaylistsArray.filter(function(e){return e.playlistId==playlistId}).length}}}),app.service("youTubeService",function($http,apiKeysService){this.getMusicVideo=function(artist,track){return $http.get("https://content.googleapis.com/youtube/v3/search?key="+apiKeysService.getYouTubeKey()+"&part=id%2Csnippet&videoEmbeddable =true&maxResults=1&type=video&q="+encodeURIComponent(artist+" - "+track),{cache:!0})},this.getAlbumPlaylist=function(artist,album){return $http.get("https://content.googleapis.com/youtube/v3/search?key="+apiKeysService.getYouTubeKey()+"&part=id%2Csnippet&videoEmbeddable =true&maxResults=1&type=playlist&q="+encodeURIComponent(artist+" - "+album),{cache:!0})},this.getArtistPlaylist=function(artist){return $http.get("https://content.googleapis.com/youtube/v3/search?key="+apiKeysService.getYouTubeKey()+"&part=id%2Csnippet&videoEmbeddable =true&maxResults=1&type=playlist&q="+encodeURIComponent(artist),{cache:!0})},this.getPlaylistVideos=function(playlistId,pageToken){var pg=pageToken?"&pageToken="+pageToken:"";return $http.get("https://www.googleapis.com/youtube/v3/playlistItems?key="+apiKeysService.getYouTubeKey()+"&part=snippet,contentDetails&maxResults=50"+pg+"&playlistId="+playlistId,{cache:!0})}}),app.controller("HeaderController",function($rootScope,$scope,$location,topsService,userService){$scope.navItems={main:[{text:"Home",url:"/"},{text:"Tracks",url:"/tracks"},{text:"Artists",url:"/artists"},{text:"Albums",url:"/albums"}],user:[{text:"Playlists",url:"/user/playlists"},{text:"Settings",url:"/user"}]},$scope.isActive=function(url){return url==$location.path()};var dft_page=1,dft_limit=5;!function(){function getUniqueImg(dataArray,headerImgs){var img="";for(var i in dataArray){for(var j in img=dataArray[i].image.pop()["#text"],headerImgs)if(img==headerImgs[j]){img="";break}if(""!=img)break}return""==img&&(img=$rootScope.fallbackImg),img}$scope.headerImgs={},$scope.headerImgs.topTrack=$rootScope.fallbackImg,$scope.headerImgs.topArtist=$rootScope.fallbackImg,$scope.headerImgs.topTag=$rootScope.fallbackImg,topsService.getTopTracks(dft_page,dft_limit).then(function(response){void 0===response.data.error?void 0!==response.data.tracks&&void 0!==response.data.tracks.track[0].image&&""!=response.data.tracks.track[0].image[0]["#text"]&&($scope.headerImgs.topTrack=getUniqueImg(response.data.tracks.track,$scope.headerImgs)):console.log(response)},function(errResponse){$scope.headerImgs.topTrack=$rootScope.fallbackImg,console.log("Error while fetching tops (header) images: "+errResponse)}),topsService.getTopArtists(dft_page,dft_limit).then(function(response){void 0===response.data.error?void 0!==response.data.artists&&void 0!==response.data.artists.artist[0].image&&""!=response.data.artists.artist[0].image[0]["#text"]&&($scope.headerImgs.topArtist=getUniqueImg(response.data.artists.artist,$scope.headerImgs)):console.log(response)},function(errResponse){$scope.headerImgs.topArtist=$rootScope.fallbackImg,console.log("Error while fetching tops (header) images: "+errResponse)}),topsService.getTopTags(dft_page,dft_limit).then(function(response){var tag=response.data.tags.tag[0].name;topsService.getTopArtistsByTag(tag).then(function(response){void 0===response.data.error?void 0!==response.data.topartists&&void 0!==response.data.topartists.artist[0].image&&""!=response.data.topartists.artist[0].image[0]["#text"]&&($scope.headerImgs.topTag=getUniqueImg(response.data.topartists.artist,$scope.headerImgs)):console.log(response)},function(errResponse){$scope.headerImgs.topTag=$rootScope.fallbackImg,console.log("Error while fetching tops (header) images: "+errResponse)})})}()}),app.controller("UserController",function($rootScope,$scope,$timeout,$location,userService,youTubeService){function logUser(data){userService.user.isLogged=!0,userService.user.avatar=$rootScope.baseUrl+data.Avatar,userService.user.name=data.Name,userService.user.email=data.Email,userService.userSecure.username=data.Username,userService.userSecure.userId=data.UserID,$timeout(function(){$rootScope.materialize.all()},10)}$scope.user=userService.user,$scope.userMethods={},$scope.userMethods.signUp=function(data){return userService.signUp(data).then(function(response){return void 0!==response.data.UserID&&logUser(response.data),response},function(errResponse){return console.log(errResponse),errResponse})},$scope.userMethods.signIn=function(data){return userService.signIn(data).then(function(response){var signInResponse=response;return void 0!==response.data.UserID?(logUser(response.data),userService.savedPlaylists.loadPlaylists().then(function(response){return signInResponse},function(errResponse){return console.log(errResponse),errResponse})):response},function(errResponse){return console.log(errResponse),errResponse})},$scope.userMethods.logOut=function(){userService.logOut().then(function(response){userService.user.isLogged=!1,userService.user.avatar=null,userService.user.name=null,userService.user.email=null,userService.userSecure.username=null,userService.userSecure.userId=null,M.toast({html:"Logged Out",displayLength:"3000"}),$location.path("/")},function(errResponse){M.toast({html:"Error on logout",classes:"red darken-4",displayLength:"3000"}),console.log(errResponse)})},$scope.sessionLoginResponse=userService.sessionLogin().then(function(response){return $scope.userMethods.signIn({username:response.data.username,password:response.data.password}).then(function(response){return response},function(errResponse){return console.log(errResponse),errResponse})},function(errResponse){return console.log(errResponse),errResponse}),$scope.$on("userSaveTrack",function(event,data){switch(data.videoData.type){case"track":playlistId=data.playlistId,artist=data.videoData.artist,track=data.videoData.track,youTubeService.getMusicVideo(artist,track).then(function(response){if(void 0===response.data.error&&void 0===response.data.error){var video=response.data.items[0],videoId=video.id.videoId,title=video.snippet.title;userService.savedPlaylists.addTrack(playlistId,{videoId:videoId,title:title,img:video.snippet.thumbnails.medium.url}).then(function(response){void 0!==response.data.TrackID?M.toast({html:"Track added",displayLength:"3000"}):(M.toast({html:"Error on track addition",classes:"red darken-4",displayLength:"3000"}),console.log(response))},function(errResponse){M.toast({html:"Error on track addition",classes:"red darken-4",displayLength:"3000"}),console.log(errResponse)})}else console.log(response)},function(errResponse){console.log(errResponse)});break;case"album":!function(playlistId,artist,album){youTubeService.getAlbumPlaylist(artist,album).then(function(response){if(void 0===response.data.error&&void 0===response.data.error){var playlist=response.data.items[0],id=playlist.id.playlistId,videosData=[];!function getVideosIds(id,pageToken){youTubeService.getPlaylistVideos(id,pageToken).then(function(response){if(void 0===response.data.error&&void 0===response.data.error){var videos=response.data.items;for(var i in videos)videosData.push({videoId:videos[i].contentDetails.videoId,title:videos[i].snippet.title,img:videos[i].snippet.thumbnails.medium.url});void 0!==response.data.nextPageToken?getVideosIds(id,response.data.nextPageToken):userService.savedPlaylists.appendPlaylist(playlistId,videosData).then(function(response){void 0!==response.data.TrackID?M.toast({html:"Tracks added",displayLength:"3000"}):(M.toast({html:"Error on tracks addition",classes:"red darken-4",displayLength:"3000"}),console.log(response))},function(errResponse){M.toast({html:"Error on tracks addition",classes:"red darken-4",displayLength:"3000"}),console.log(errResponse)})}else console.log(response)},function(errResponse){console.log(errResponse)})}(id,null)}else console.log(response)},function(errResponse){console.log(errResponse)})}(data.playlistId,data.videoData.artist,data.videoData.album);break;case"artist":!function(playlistId,artist){youTubeService.getArtistPlaylist(artist).then(function(response){if(void 0===response.data.error&&void 0===response.data.error){var playlist=response.data.items[0],id=playlist.id.playlistId,videosData=[];!function getVideosIds(id,pageToken){youTubeService.getPlaylistVideos(id,pageToken).then(function(response){if(void 0===response.data.error&&void 0===response.data.error){var videos=response.data.items;for(var i in videos)videosData.push({videoId:videos[i].contentDetails.videoId,title:videos[i].snippet.title,img:videos[i].snippet.thumbnails.medium.url});void 0!==response.data.nextPageToken?getVideosIds(id,response.data.nextPageToken):userService.savedPlaylists.appendPlaylist(playlistId,videosData).then(function(response){void 0!==response.data.TrackID?M.toast({html:"Tracks added",displayLength:"3000"}):(M.toast({html:"Error on tracks addition",classes:"red darken-4",displayLength:"3000"}),console.log(response))},function(errResponse){M.toast({html:"Error on tracks addition",classes:"red darken-4",displayLength:"3000"}),console.log(errResponse)})}else console.log(response)},function(errResponse){console.log(errResponse)})}(id,null)}else console.log(response)},function(errResponse){console.log(errResponse)})}(data.playlistId,data.videoData.artist);break;default:throw'Invalid video type "'+data.videoData.type+'"'}var playlistId,artist,track})}),app.controller("AlbumsController",function($rootScope,$scope,$location,albumsService,topsService,artistsService){var dft_page=1,dft_limit=5;!function(page,limit){if(void 0===page)var page=dft_page;if(void 0===limit)var limit=dft_limit;topsService.getTopArtists(page,limit).then(function(response){if(void 0===response.data.error){$scope.albums=[];var topArtists=response.data.artists.artist;for(var i in topArtists)!function(j){var artist=topArtists[j].name,rndPage=1+Math.floor(2*Math.random());artistsService.getTopAlbums(artist,rndPage,1).then(function(response){if(void 0===response.data.error){var rndAlbum=response.data.topalbums.album.pop();void 0!==rndAlbum&&($scope.albums[j]=rndAlbum,albumsService.getAlbumInfo(rndAlbum.artist.name,rndAlbum.name).then(function(response){void 0===response.data.error?void 0!==response.data.album&&($scope.albums[j].info=response.data.album,void 0!==response.data.album.image&&""!=response.data.album.image[0]["#text"]&&($scope.albums[j].image=response.data.album.image)):console.log(response)},function(errResponse){console.log(errResponse)}).finally(function(){"undefined"!==$scope.albums[j].image&&""==$scope.albums[j].image[0]["#text"]&&($scope.albums[j].image=[{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg}]),$scope.albums[j].imgsDone=!0}))}else console.log(response)},function(errResponse){console.log(errResponse)})}(i)}else console.log(response)},function(errResponse){console.log(errResponse)})}(1,5),$scope.getAlbumSearch=function(album,page,limit){if(void 0===page)page=dft_page;if(void 0===limit)limit=dft_limit;albumsService.getAlbumSearch(album,page,limit).then(function(response){if(void 0===response.data.error)for(var i in $scope.searchedAlbums=response.data.results.albummatches.album.slice(-limit),$scope.searchedAlbums)!function(j){albumsService.getAlbumInfo($scope.searchedAlbums[j].artist,$scope.searchedAlbums[j].name).then(function(response){void 0===response.data.error?void 0!==response.data.album&&($scope.searchedAlbums[j].info=response.data.album,void 0!==response.data.album.image&&""!=response.data.album.image[0]["#text"]&&($scope.searchedAlbums[j].image=response.data.album.image)):console.log(response.data)},function(errResponse){console.log(errResponse)}).finally(function(){"undefined"!==$scope.searchedAlbums[j].image&&""==$scope.searchedAlbums[j].image[0]["#text"]&&($scope.searchedAlbums[j].image=[{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg}]),$scope.searchedAlbums[j].imgsDone=!0})}(i);else console.log(response)},function(errResponse){console.log(errResponse)})},$scope.onSearch=function(searchKey){return void 0!==(key=searchKey)&&""!=key&&($location.search("search",searchKey),$scope.searchKey=searchKey,$scope.isSearch=!0,$scope.getAlbumSearch(searchKey,dft_page,dft_limit),!0);var key},$scope.onClose=function(){$scope.isSearch=!1},$scope.onPageChange=function(page){$scope.getAlbumSearch($scope.searchKey,page,dft_limit)},$scope.saveOnPlaylist=function(playlistId,videoData){$rootScope.$broadcast("userSaveTrack",{playlistId:playlistId,videoData:videoData})},$scope.ytVideo={open:function(videoData){$rootScope.$broadcast("ytPlayVideo",videoData)}},$scope.getArtistUrlFromString=function(strUrl){return"https://www.last.fm/music/"+strUrl.split("https://www.last.fm/music/")[1].split("/")[0]},$scope.stripLink=function(text){return text.replace(/<a(.|\n)*?<\/a>/,"").trim()},$scope.getSummaryLink=function(text){return text.match(/<a(.|\n)*?<\/a>/)[0].match(/href="(.|\n)*?"/)[0].replace('href="',"").replace('"',"")},$scope.searchFor=function(type,value){switch(type){case"track":return $rootScope.baseUrl+"#!/tracks?search="+value;case"artist":return $rootScope.baseUrl+"#!/artists?search="+value;case"album":return $rootScope.baseUrl+"#!/albums?search="+value;default:throw'Invalid video type "'+type+'"'}}}),app.controller("ArtistsController",function($rootScope,$scope,$location,artistsService,topsService){var dft_page=1,dft_limit=5;!function(page,limit){if(void 0===page)var page=dft_page;if(void 0===limit)var limit=dft_limit;topsService.getTopArtists(page,limit).then(function(response){if(void 0===response.data.error)for(var i in $scope.artists=response.data.artists.artist.slice(-limit),$scope.artists)!function(j){artistsService.getArtistInfo($scope.artists[j].name).then(function(response){void 0===response.data.error?void 0!==response.data.artist&&($scope.artists[j].info=response.data.artist,void 0!==response.data.artist.image&&""!=response.data.artist.image[0]["#text"]&&($scope.artists[j].image=response.data.artist.image)):console.log(response)},function(errResponse){console.log(errResponse)}).finally(function(){"undefined"!==$scope.artists[j].image&&""==$scope.artists[j].image[0]["#text"]&&($scope.artists[j].image=[{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg}]),$scope.artists[j].imgsDone=!0})}(i);else console.log(response)},function(errResponse){console.log(errResponse)})}(1,5),$scope.getArtistSearch=function(artist,page,limit){if(void 0===page)page=dft_page;if(void 0===limit)limit=dft_limit;artistsService.getArtistSearch(artist,page,limit).then(function(response){if(void 0===response.data.error)for(var i in $scope.searchedArtists=response.data.results.artistmatches.artist.slice(-limit),$scope.searchedArtists)!function(j){artistsService.getArtistInfo($scope.searchedArtists[j].name).then(function(response){void 0===response.data.error?void 0!==response.data.artist&&($scope.searchedArtists[j].info=response.data.artist,void 0!==response.data.artist.image&&""!=response.data.artist.image[0]["#text"]&&($scope.searchedArtists[j].image=response.data.artist.image)):console.log(response.data)},function(errResponse){console.log(errResponse)}).finally(function(){"undefined"!==$scope.searchedArtists[j].image&&""==$scope.searchedArtists[j].image[0]["#text"]&&($scope.searchedArtists[j].image=[{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg}]),$scope.searchedArtists[j].imgsDone=!0})}(i);else console.log(response)},function(errResponse){console.log(errResponse)})},$scope.onSearch=function(searchKey){return void 0!==(key=searchKey)&&""!=key&&($location.search("search",searchKey),$scope.searchKey=searchKey,$scope.isSearch=!0,$scope.getArtistSearch(searchKey,dft_page,dft_limit),!0);var key},$scope.onClose=function(){$scope.isSearch=!1},$scope.onPageChange=function(page){$scope.getArtistSearch($scope.searchKey,page,dft_limit)},$scope.saveOnPlaylist=function(playlistId,videoData){$rootScope.$broadcast("userSaveTrack",{playlistId:playlistId,videoData:videoData})},$scope.ytVideo={open:function(videoData){$rootScope.$broadcast("ytPlayVideo",videoData)}},$scope.stripLink=function(text){return text.replace(/<a(.|\n)*?<\/a>/,"").trim()},$scope.searchFor=function(type,value){switch(type){case"track":return $rootScope.baseUrl+"#!/tracks?search="+value;case"artist":return $rootScope.baseUrl+"#!/artists?search="+value;case"album":return $rootScope.baseUrl+"#!/albums?search="+value;default:throw'Invalid video type "'+type+'"'}}}),app.controller("HomeController",function($rootScope,$scope,topsService,tracksService){var dft_page=1,dft_limit=5;$scope.getRandomTracks=function(limit){if(void 0===limit)limit=dft_limit;var page=1+Math.floor(14*Math.random());topsService.getTopTracks(page,limit).then(function(response){if(void 0===response.data.error)for(var i in $scope.rndTracks=response.data.tracks.track.slice(-limit),$scope.rndTracks)!function(j){tracksService.getTrackInfo($scope.rndTracks[j].artist.name,$scope.rndTracks[j].name).then(function(response){void 0===response.data.error?void 0!==response.data.track&&($scope.rndTracks[j].info=response.data.track,void 0!==response.data.track.album&&""!=response.data.track.album.image[0]["#text"]&&($scope.rndTracks[j].image=response.data.track.album.image)):console.log(response)},function(errResponse){console.log(errResponse)}).finally(function(){"undefined"!==$scope.rndTracks[j].image&&""==$scope.rndTracks[j].image[0]["#text"]&&($scope.rndTracks[j].image=[{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg}]),$scope.rndTracks[j].imgsDone=!0})}(i);else console.log(response)},function(errResponse){$scope.rndTracks=$scope.tracks,console.log(errResponse)})},$scope.getRandomTracks(5),$scope.getTopTracks=function(page,limit){if(void 0===page)page=dft_page;if(void 0===limit)limit=dft_limit;var progressBar=$$("#tracks-wrapper .progress");angular.element(progressBar).removeClass("hide"),topsService.getTopTracks(page,limit).then(function(response){if(angular.element(progressBar).addClass("hide"),void 0===response.data.error)for(var i in $scope.tracks=response.data.tracks.track.slice(-limit),$scope.tracks)!function(j){tracksService.getTrackInfo($scope.tracks[j].artist.name,$scope.tracks[j].name).then(function(response){void 0===response.data.error?void 0!==response.data.track&&($scope.tracks[j].info=response.data.track,void 0!==response.data.track.album&&""!=response.data.track.album.image[0]["#text"]&&($scope.tracks[j].image=response.data.track.album.image)):console.log(response)},function(errResponse){console.log(errResponse)}).finally(function(){"undefined"!==$scope.tracks[j].image&&""==$scope.tracks[j].image[0]["#text"]&&($scope.tracks[j].image=[{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg}]),$scope.tracks[j].imgsDone=!0})}(i);else console.log(response)},function(errResponse){angular.element(progressBar).addClass("hide"),console.log(errResponse)})},$scope.getTopArtists=function(page,limit){if(void 0===page)page=dft_page;void 0===limit&&(limit=dft_limit);var progressBar=$$("#artists-wrapper .progress");angular.element(progressBar).removeClass("hide"),topsService.getTopArtists(page,limit).then(function(response){if(angular.element(progressBar).addClass("hide"),void 0===response.data.error)for(var i in $scope.artists=response.data.artists.artist.slice(-limit),$scope.artists)$scope.artists[i].imgsDone=!0;else console.log(response)},function(errResponse){angular.element(progressBar).addClass("hide"),console.log(errResponse)})},$scope.getTopTags=function(page,limit){if(void 0===page)page=dft_page;if(void 0===limit)limit=dft_limit;var progressBar=$$("#tags-wrapper .progress");angular.element(progressBar).removeClass("hide"),topsService.getTopTags(page,limit).then(function(response){if(angular.element(progressBar).addClass("hide"),void 0===response.data.error)for(var i in $scope.tags=response.data.tags.tag.slice(-limit),$scope.tags)!function(j){$scope.tags[j].image=[{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg}],topsService.getTopArtistsByTag($scope.tags[j].name,page,limit).then(function(response){void 0===response.data.error?$scope.tags[j].image=response.data.topartists.artist[0].image:console.log(response)},function(errResponse){console.log(errResponse)}).finally(function(){"undefined"!==$scope.tags[j].image&&""==$scope.tags[j].image[0]["#text"]&&($scope.tags[j].image=[{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg}]),$scope.tags[j].imgsDone=!0})}(i);else console.log(response)},function(errResponse){angular.element(progressBar).addClass("hide"),console.log(errResponse)})},$scope.searchFor=function(type,value){switch(type){case"track":return $rootScope.baseUrl+"#!/tracks?search="+value;case"artist":return $rootScope.baseUrl+"#!/artists?search="+value;case"album":return $rootScope.baseUrl+"#!/albums?search="+value;default:throw'Invalid video type "'+type+'"'}}}),app.controller("TracksController",function($rootScope,$scope,$location,tracksService,topsService){var dft_page=1,dft_limit=5;!function(page,limit){if(void 0===page)var page=dft_page;if(void 0===limit)var limit=dft_limit;topsService.getTopTracks(page,limit).then(function(response){if(void 0===response.data.error)for(var i in $scope.tracks=response.data.tracks.track.slice(-limit),$scope.tracks)!function(j){tracksService.getTrackInfo($scope.tracks[j].artist.name,$scope.tracks[j].name).then(function(response){void 0===response.data.error?void 0!==response.data.track&&($scope.tracks[j].info=response.data.track,void 0!==response.data.track.album&&""!=response.data.track.album.image[0]["#text"]&&($scope.tracks[j].image=response.data.track.album.image)):console.log(response)},function(errResponse){console.log(errResponse)}).finally(function(){"undefined"!==$scope.tracks[j].image&&""==$scope.tracks[j].image[0]["#text"]&&($scope.tracks[j].image=[{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg}]),$scope.tracks[j].imgsDone=!0})}(i);else console.log(response)},function(errResponse){console.log(errResponse)})}(1,5),$scope.getTrackSearch=function(track,page,limit){if(void 0===page)page=dft_page;if(void 0===limit)limit=dft_limit;tracksService.getTrackSearch(track,page,limit).then(function(response){if(void 0===response.data.error)for(var i in $scope.searchedTracks=response.data.results.trackmatches.track.slice(-limit),$scope.searchedTracks)!function(j){tracksService.getTrackInfo($scope.searchedTracks[j].artist,$scope.searchedTracks[j].name).then(function(response){void 0===response.data.error?void 0!==response.data.track&&($scope.searchedTracks[j].info=response.data.track,void 0!==response.data.track.album&&""!=response.data.track.album.image[0]["#text"]&&($scope.searchedTracks[j].image=response.data.track.album.image)):console.log(response)},function(errResponse){console.log(errResponse)}).finally(function(){"undefined"!==$scope.searchedTracks[j].image&&""==$scope.searchedTracks[j].image[0]["#text"]&&($scope.searchedTracks[j].image=[{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg},{"#text":$rootScope.fallbackImg}]),$scope.searchedTracks[j].imgsDone=!0})}(i);else console.log(response)},function(errResponse){console.log(errResponse)})},$scope.onSearch=function(searchKey){return void 0!==(key=searchKey)&&""!=key&&($location.search("search",searchKey),$scope.searchKey=searchKey,$scope.isSearch=!0,$scope.getTrackSearch(searchKey,dft_page,dft_limit),!0);var key},$scope.onClose=function(){$scope.isSearch=!1},$scope.onPageChange=function(page){$scope.getTrackSearch($scope.searchKey,page,dft_limit)},$scope.saveOnPlaylist=function(playlistId,videoData){$rootScope.$broadcast("userSaveTrack",{playlistId:playlistId,videoData:videoData})},$scope.ytVideo={open:function(videoData){$rootScope.$broadcast("ytPlayVideo",videoData)}},$scope.formatDuration=function(time){var minutes=Math.floor(time/60/1e3),seconds=Math.round(60*(time/60/1e3-Math.floor(time/60/1e3)));return minutes+":"+(seconds=seconds<10?seconds+"0":seconds)},$scope.searchFor=function(type,value){switch(type){case"track":return $rootScope.baseUrl+"#!/tracks?search="+value;case"artist":return $rootScope.baseUrl+"#!/artists?search="+value;case"album":return $rootScope.baseUrl+"#!/albums?search="+value;default:throw'Invalid video type "'+type+'"'}}}),app.controller("UserPlaylistsController",function($rootScope,$scope,$route,$timeout,$location,userService){$scope.playlists=userService.savedPlaylists.getAllPlaylists(),$scope.state={renamingPlaylist:!1},$scope.$parent.sessionLoginResponse.then(function(response){userService.user.isLogged?($scope.playlists=userService.savedPlaylists.getAllPlaylists(),function(){var pl=0;if(void 0!==$location.search().pl){var tempPl=$location.search().pl;void 0!==$scope.playlists[tempPl]&&(pl=parseInt(tempPl))}void 0!==$scope.playlists[pl]&&($scope.activePlaylist={playlistId:$scope.playlists[pl].playlistId,name:$scope.playlists[pl].name,list:$scope.playlists[pl].list,index:pl})}()):($location.search("pl",null),$location.path("/"))},function(errResponse){console.log(errResponse)}),$scope.selectPlaylist=function(playlistId){var playlist=userService.savedPlaylists.getPlaylist(playlistId),index=userService.savedPlaylists.getIndexId(playlistId);$scope.activePlaylist={playlistId:playlist.playlistId,name:playlist.name,list:playlist.list,index:index},$location.search("pl",index)},$scope.deletePlaylist=function(playlistId){userService.savedPlaylists.deletePlaylist(playlistId).then(function(response){if(void 0!==response.data.UserID){M.toast({html:"Playlist deleted",displayLength:"3000"});var index=userService.savedPlaylists.getIndexId(playlistId),prev=0==index?userService.savedPlaylists.getAllPlaylists().length-1:index-1;$location.search("pl",prev),$route.reload()}else M.toast({html:"Error on playlist deletion",classes:"red darken-4",displayLength:"3000"}),console.log(response)},function(errResponse){M.toast({html:"Error on playlist deletion",classes:"red darken-4",displayLength:"3000"}),console.log(errResponse)})},$scope.renamePlaylist=function(playlistId,newName){$scope.state.renamingPlaylist=!1,userService.savedPlaylists.renamePlaylist(playlistId,newName).then(function(response){void 0!==response.data.PlaylistID?(M.toast({html:"Playlist renamed",displayLength:"3000"}),$route.reload()):(M.toast({html:"Error on playlist creation",classes:"red darken-4",displayLength:"3000"}),console.log(response))},function(errResponse){M.toast({html:"Error on playlist creation",classes:"red darken-4",displayLength:"3000"}),console.log(errResponse)})},$scope.removeTrack=function(playlistId,trackId){userService.savedPlaylists.removeTrack(playlistId,trackId).then(function(response){void 0!==response.data.TrackID?M.toast({html:"Track removed",displayLength:"3000"}):(M.toast({html:"Error on track removal",classes:"red darken-4",displayLength:"3000"}),console.log(response))},function(errResponse){M.toast({html:"Error on track removal",classes:"red darken-4",displayLength:"3000"}),console.log(errResponse)})},$scope.ytVideo={open:function(videoData){$rootScope.$broadcast("ytPlayVideo",videoData)},playCustomPlaylist:function(playlistId){0<$scope.activePlaylist.list.length&&$rootScope.$broadcast("ytPlayCustomPlaylist",userService.savedPlaylists.getPlaylist(playlistId).list)}},$scope.showInput=function(){$scope.state.renamingPlaylist=!0,setTimeout(function(){$$(".playlist-name input")[0].focus()},100)},$scope.onBlur=function(){$timeout(function(){$scope.state.renamingPlaylist=!1},1e3)}}),app.controller("UserSettingsController",function($rootScope,$scope,$location,userService,FileUploader){$scope.$parent.sessionLoginResponse.then(function(response){userService.user.isLogged?$scope.userSecure=userService.userSecure:$location.path("/")},function(errResponse){console.log(errResponse)});M.Tooltip.init($$(".tooltipped"),{});$scope.uploader=new FileUploader({alias:"avatar",queueLimit:1,removeAfterUpload:!0}),$scope.uploader.onAfterAddingFile=function(item){item.url=$rootScope.baseUrl+"src/php/settings.update.php",item.formData=[{userId:userService.userSecure.userId}]},$scope.uploader.onWhenAddingFileFailed=function(item,filter,options){"queueLimit"==filter.name&&($scope.uploader.clearQueue(),$scope.uploader.addToQueue(item))},$scope.onSubmit=function(){$scope.uploader.queue[0].onSuccess=function(response,status,headers){"1"==response&&console.log(response)},$scope.uploader.uploadItem(0)}});
//# sourceMappingURL=app.min.js.map